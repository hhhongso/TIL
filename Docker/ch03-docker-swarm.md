---
layout: post
title: [Docker] ch03. 도커 스웜 
tags: [docker, kubernetes]
author: shong91
excerpt_separator: 
---
# chapter03 도커 스웜

## 1. 도커 스웜
**도커 스웜 = 도커 서버의 확장.**

도커 서버를 하나의 클러스터로 만들어 컨테이너를 생성, 기능을 제공한다. 또한, 스웜 클러스터에 등록된 서버의 컨테이너를 쉽게 관리할 수 있다. 

### 도커 스웜의 종류
- 스웜 클래식 (컨테이너로서의 스웜)
    + 여러 대의 도커 서버를 하나의 지점에서 사용하도록 단일 접근점을 제공
    + 일반적인 도커 명령어(docker run, docker ps 등)와 도커 API로 클러스터 서버를 제어하고 관리하는 기능을 제공
    + 분산 코디네이터, 에이전트 등의 클러스터 툴이 별도로 실행되어야 함
    
- 스웜 모드
    + MSA 컨테이너를 다루기 위한 클러스터링 기능에 초점 
    + 같은 컨테이너를 동시에 여러 개 생성하여 유동적으로 컨테이너 수를 조절
    + 컨테이너로의 연결을 분산하는 로드밸런싱 기능을 자체적으로 지원
    + 분산 코디네이터, 에이전트 등 클러스터링을 위한 모든 도구가 도커 엔진 자체에 내장되어 있음
    + 대규모 클러스터에서의 서비스 운영에 유리
    
cf) 클러스터 툴 ?
- 분산 코디네이터(Distributed Coordinator): 여러 개의 도커 서버를 하나의 클러스터로 구성하기 위해 각종 정보를 저장하고 동기화하는 역할
- 에이전트: 클러스터 내의 서버를 관리하고 제어하는 역할 

<br>

### 도커 스웜 모드의 구조

- 매니저 노드
    + 워커 노드를 관리하기 위한 도커 서버
    + 매니저 노드는 1개 이상 있어야 하지만, 워커 노드는 없을 수도 있다 
    
- 워커 노드
    + 실제 컨테이너가 생성, 관리되는 도커 서버


**1. 매니저 역할을 할 서버에서 스웜 클러스터를 시작하기**

`--advertise-addr` 옵션으로 워커 노드들이 접근할 수 있도록 매니저 노드의 IP 주소를 입력한다.

```
    docker swarm init --advertise-addr ${IP}
```


**2. 새로운 워커 노드를 스웜 클러스터에 추가하기**

`--token` 옵션의 토큰 값은 새로운 노드를 스웜 클러스터에 추가하기 위한 비밀 키이다.

```
docker swarm join --token ${TOKEN}
```

**3. 노드 리스트 확인하기** 

```
docker node ls
```

**4. 워커 노드 삭제하기** 

`leave` 명령어는 워커 노드의 상태를 down 시키는 역할만 하므로, 삭제를 위해서는 rm 명렁어를 사용하여야 한다.  
```
docker swarm leave && docker node rm ${worker-node}
```

**5. 매니저 노드 삭제하기**

매니저 노드 삭제 시에는 `--force` 옵션 필요. 단, 매니저 노드를 스웜 클러스터에서 삭제 시 해당 노드에 저장되어 있던 클러스터의 정보도 삭제된다. 
```
docker swawrm leave --force
```